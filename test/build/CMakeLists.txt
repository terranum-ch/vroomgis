# CMAKE BUILD FILE FOR TESTING VROOMGIS
# USE WXWIDGETS (CONSOLE)
# PART OF QA FOR VROOMGIS 
# (c) LUCIEN SCHREIBER CREALP 2009
cmake_minimum_required(VERSION 2.4)


## POLICY FOR WINDOWS ONLY ???
if(COMMAND cmake_policy)
    cmake_policy(SET CMP0003 NEW)
endif(COMMAND cmake_policy)

# REMOVE THIS LINE IF CALLED FROM ANOTHER CMAKE FILE
SET (PROGNAME "vroomgis")
SET (PROGNAMETEST ${PROGNAME}_test)
PROJECT(${PROGNAMETEST})


#search all source files
FILE (GLOB SRC_FILES ../src/*.cpp)
SOURCE_GROUP(source FILES ${SRC_FILES})

# search all headers files
FILE (GLOB HEAD_FILES "../src/*.h")
SOURCE_GROUP(header FILES ${HEAD_FILES})

MESSAGE ("Build type is : " ${CMAKE_BUILD_TYPE})

#ONLY USED FOR ADDING HEADERS TO PROJECT 
IF(APPLE)
	ADD_EXECUTABLE("${PROGNAMETEST}-not_build" EXCLUDE_FROM_ALL main.cpp ${HEAD_FILES})
ENDIF(APPLE)


 # GTK LIB IF LINUX
MESSAGE("System name is : " ${CMAKE_SYSTEM_NAME})
 IF(CMAKE_SYSTEM_NAME STREQUAL "Linux")
 	MESSAGE("Systeme linux detecte")
 	INCLUDE ("../../build/cmake/FindGTK2.cmake")
 	INCLUDE_DIRECTORIES(${GTK2_INCLUDE_DIRS})
 	MESSAGE("Gtk include is " ${GTK2_INCLUDE_DIRS})
 ENDIF(CMAKE_SYSTEM_NAME STREQUAL "Linux")


#CREATE VROOMGIS LIBRARY
INCLUDE("../../build/cmake/Use_vroomGISlib.cmake")


#PARAMETERS FOR TEST
SET(UNIT_TESTING_PATH CACHE PATH "Location of unit testing files and projects")
IF(NOT UNIT_TESTING_PATH)
	MESSAGE(FATAL_ERROR "Unit testing path not specified, tests are going to fail")
ENDIF(NOT UNIT_TESTING_PATH)
CONFIGURE_FILE("../src/test_param.h.in" "${PROJECT_BINARY_DIR}/test_param.h")
INCLUDE_DIRECTORIES(${PROJECT_BINARY_DIR})

 
## CXXTEST LIBRARY STUFF
# Use Python interpreter
FIND_PACKAGE(PythonInterp)
# Fait la liaison avec la bibliothèque CxxTest  
INCLUDE("../../build/cmake/FindCxxTest.cmake")
SET(CXXTEST_USE_PYTHON 1)
INCLUDE_DIRECTORIES(${CXXTEST_INCLUDE_DIR})
ENABLE_TESTING()

CXXTEST_ADD_TEST(${PROGNAMETEST} main.cpp ${HEAD_FILES})

# USE VROOMGIS LIBRARY
TARGET_LINK_LIBRARIES(${PROGNAMETEST} ${VR_LIBRARY_NAME})


# SHOULD WE USE THE MT VERSION FOR DEFAULT 
# COMPATIBILITY WITH < WINXP
IF (WIN32)
	INCLUDE ("../../build/cmake/Use_visualstudioMT.cmake")
	ADD_DEFINITIONS (/D _CRT_SECURE_NO_WARNINGS)
ENDIF (WIN32)

